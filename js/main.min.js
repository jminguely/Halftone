function hexagon(e,t){function r(e){this.center_x=e[0];this.center_y=e[1];this.points=[];for(var t=0;t<6;t++){var n=2*Math.PI/6*(t+.5),r=this.center_x+hexRadius*Math.cos(n),i=this.center_y+hexRadius*Math.sin(n);this.points.push([r,i])}}var n;this.color=t;this.setCoord=r;this.setCoord(e)}var grid,hexagon,portfolio,hexagons=[],hexRadius=5,hexHeight=hexRadius*2,hexWidth=Math.sqrt(3)/2*hexHeight,widthWindow=$(window).width(),heightWindow=$(window).height(),widthSideBar=$("aside").width(),listTools=[],listCategories=[],listAreas=[],zoomLevel=0;grid={widthGrid:0,heightGrid:0,cols:100,rows:100,draw:"",viewport:"",calculateGrid:function(){this.widthGrid=$("svg#grid").width();this.heightGrid=$("svg#grid").height()},init:function(){grid.calculateGrid();$("#grid").on("mouseenter",".hexagon",function(e){var t=this.instance.attr("data-index");hexagons[t]!==undefined&&hexagons[t].shape!==undefined&&hexagons[t].shape.attr("class","hexagon hover").front();var t=this.instance.attr("data-index"),n=grid.getAxialCoordByIndex(t),r=grid.convertAxialCoordtoCube(n)}).on("mouseleave",".hexagon",function(e){var t=this.instance.attr("data-index");hexagons[t]!==undefined&&hexagons[t].shape!==undefined&&hexagons[t].shape.attr("class","hexagon")});$("#grid").on("click",".hexagon",function(e){var t=this.instance.attr("data-index"),n=grid.getAxialCoordByIndex(t),r=grid.convertAxialCoordtoCube(n);if(zoomLevel===0){grid.focusViewportOnElement(n,5);zoomLevel++}else if(zoomLevel===1){grid.focusViewportOnElement(n,10);zoomLevel++}else{grid.focusViewportOnElement(n,.5);zoomLevel=0}grid.glowCardinal(r,10)});for(var e=0;e<this.cols;e++)for(var t=0;t<this.rows;t++){var n="#010101";hexagons.push(new hexagon([this.widthGrid/2,this.heightGrid/2],n))}},componentToHex:function(e){var t=e.toString(16);return t.length==1?"0"+t:t},rgbToHex:function(e,t,n){return"#"+grid.componentToHex(e)+grid.componentToHex(t)+grid.componentToHex(n)},loadImage:function(){var e=document.getElementById("canvas"),t=e.getContext("2d");e.width=e.height=500;var n=new Image;n.onload=function(){t.drawImage(n,0,0,n.width,n.height,0,0,e.width,e.height);var r=t.getImageData(0,0,e.width,e.height);for(var i=0;i<grid.rows;i++)for(var s=0;s<grid.cols;s++){var o=Math.floor(e.width/grid.cols*s),u=Math.floor(e.height/grid.rows*i),a=4*(o+u*e.width),f=r.data[a],l=r.data[a+1],c=r.data[a+2],h=r.data[a+3],p=grid.rgbToHex(f,l,c),d=grid.getIndexByCoordinates([s,i]);hexagons[d]!==undefined&&hexagons[d].shape!==undefined&&hexagons[d].shape.fill(p)}portfolio.init()};n.src="img/Cats.jpg"},updateGrid:function(){var e=0,t=0;grid.calculateGrid();for(i in hexagons){hexagons[i].setCoord(this.getCenterCoordinates(e,t));if(e<this.cols-1)e++;else{e=0;t++}}},focusViewportOnElement:function(e,t){e=typeof e!="undefined"?e:[Math.floor(this.cols/2),Math.floor(this.rows/2)];t=typeof t!="undefined"?t:1;var n=grid.getIndexByCoordinates(e);if(hexagons[n]!==undefined&&hexagons[n].shape!==undefined){var r=-hexagons[n].center_x*t+(widthWindow/2+widthSideBar/2),i=-hexagons[n].center_y*t+heightWindow/2;grid.updateViewport(r,i,t)}},updateViewport:function(e,t,n){grid.viewport.animate(1e3,SVG.easing.circInOut).transform({x:e,y:t,scaleX:n,scaleY:n})},draw:function(){grid.draw=SVG("grid");grid.viewport=grid.draw.group().transform({x:0,y:0,scaleX:1,scaleY:1});for(i in hexagons)hexagons[i].shape=grid.viewport.polygon("").plot(hexagons[i].points).attr("data-index",i).attr("data-coord",hexagons[i]).attr("class","hexagon")},glowCardinal:function(e,t){for(var n=0;n<t;n++)(function(t){var n=setTimeout(function(){var n=grid.getAllCubeCoordCardinal(e,t);for(var r in n){var i=grid.convertCubeCoordToAxial(n[r]),s=grid.getIndexByCoordinates(i);hexagons[s]!==undefined&&hexagons[s].shape!==undefined&&hexagons[s].shape.attr("class","hexagon active")}setTimeout(function(){for(var e in n){var t=grid.convertCubeCoordToAxial(n[e]),r=grid.getIndexByCoordinates(t);hexagons[r]!==undefined&&hexagons[r].shape!==undefined&&hexagons[r].shape.attr("class","hexagon")}},300)},t*60)})(n)},glowRadial:function(e,t){for(var n=0;n<t;n++)(function(t){var n=setTimeout(function(){var n=grid.getAllCubeCoordCircle(e,t);for(var r in n){var i=grid.convertCubeCoordToAxial(n[r]),s=grid.getIndexByCoordinates(i);hexagons[s]!==undefined&&hexagons[s].shape!==undefined&&hexagons[s].shape.attr("class","hexagon active")}setTimeout(function(){for(var e in n){var t=grid.convertCubeCoordToAxial(n[e]),r=grid.getIndexByCoordinates(t);hexagons[r]!==undefined&&hexagons[r].shape!==undefined&&hexagons[r].shape.attr("class","hexagon")}},300)},t*60)})(n)},updateDraw:function(){this.updateGrid();for(i in hexagons)hexagons[i].shape.plot(hexagons[i].points)},convertCubeCoordToAxial:function(e){var t=e[0]+(e[2]+(e[2]&1))/2,n=e[2];return[t,n]},convertAxialCoordtoCube:function(e){var t=e[0]-(e[1]+(e[1]&1))/2,n=e[1],r=-t-n;return[t,r,n]},getAxialCoordByIndex:function(e){var t=e%grid.cols,n=Math.floor(e/grid.cols);return[t,n]},getAllCubeCoordCardinal:function(e,t){var n=[],r;for(r=0;r<6;r++)n.push(grid.getCubeCoordNeighbor(e,r,t));return n},getAllCubeCoordCircle:function(e,t){var n=[],r=4,i=0,s=grid.getCubeCoordNeighbor(e,r,t);for(r=0;r<6;r++)for(i=0;i<t;i++){n.push(s);s=grid.getCubeCoordNeighbor(s,r,1)}return n},getCubeCoordNeighbor:function(e,t,n){var r=[];r=[[+n,-n,0],[+n,0,-n],[0,+n,-n],[-n,+n,0],[-n,0,+n],[0,-n,+n]];var i=r[t];return[e[0]+i[0],e[1]+i[1],e[2]+i[2]]},getIndexByCoordinates:function(e){return e[0]+e[1]*grid.cols},getCenterCoordinates:function(e,t){var n=.5*hexHeight*t+.25*hexHeight*t;if(t%2===0)var r=hexWidth*e+.5*hexWidth;else var r=hexWidth*e;return[r,n]},getFreeNeighbor:function(e){var t=!1,n=grid.getAllCubeCoordCircle(e,1);n.forEach(function(e){var n=grid.convertCubeCoordToAxial(e);portfolio.listProjets.forEach(function(e){if(!t&&e.coord!==undefined&&(e.coord[0]!==n[0]||e.coord[1]!==n[0])){t=!0;return n}})})},getFreeCenterCoordinates:function(e){var t=0,n=0;e.forEach(function(e){t+=e[0];n+=e[1]});t=Math.floor(t/e.length);n=Math.floor(n/e.length);var r=[t,n];portfolio.listProjets.forEach(function(e){if(e.coord!=undefined&&e.coord[0]===t&&e.coord[1]===n){var i=grid.convertAxialCoordtoCube([t,n]);r=grid.getFreeNeighbor(i);console.log(r)}});return r}};portfolio={listProjets:[],init:function(){$.ajax({url:"data/projets.json",async:!1,cache:!1,dataType:"json",success:function(e){portfolio.listProjets=e;portfolio.listProjets.forEach(function(e){e.tools.forEach(function(e){e in listTools?listTools[e]++:listTools[e]=1});e.categories.forEach(function(e){e in listCategories?listCategories[e]++:listCategories[e]=1})});portfolio.defineAreas();listCategories=portfolio.sortObject(listCategories);listTools=portfolio.sortObject(listTools);for(var t in listCategories)listCategories.hasOwnProperty(t)&&$("#listCategories").append('<li><span class="title">'+t+'</span><span class="count">'+listCategories[t]+"</span></li>");for(var n in listTools)listTools.hasOwnProperty(n)&&$("#listTools").append('<li><span class="title">'+n+'</span><span class="count">'+listTools[n]+"</span></li>");portfolio.listProjets.forEach(function(e){var t=[];e.categories.forEach(function(e){t.push(listAreas[e])});e.coord=grid.getFreeCenterCoordinates(t);var n=grid.getIndexByCoordinates(e.coord);hexagons[n]!==undefined&&hexagons[n].shape!==undefined&&hexagons[n].shape.fill("blue")})}});$("aside").addClass("active")},defineAreas:function(){var e=Object.keys(listCategories),t=e.length,n=Math.ceil(Math.sqrt(t)),r=Math.ceil(t/n),i=0;for(var s=0;s<n;s++)for(var o=0;o<r;o++){if(e[i]){var u=Math.floor(grid.cols/(n+1)*(s+1)),a=Math.floor(grid.rows/(r+1)*(o+1));listAreas[e[i]]=[u,a];var f=grid.getIndexByCoordinates(listAreas[e[i]]);hexagons[f]!==undefined&&hexagons[f].shape!==undefined&&hexagons[f].shape.fill("red")}i++}},sortObject:function(e){var t={},n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(n);r.sort();for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t}};$(document).ready(function(){grid.init();grid.draw();grid.updateGrid();grid.updateDraw();grid.loadImage();$(window).resize(function(){widthWindow=$(window).width();heightWindow=$(window).height();widthSideBar=$("aside").width()});$(window).resize();$("#zoomOut").click(function(){grid.focusViewportOnElement(undefined,1);zoomLevel=0;return!1});$("#zoomOut").click()});